<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="reading">
	<select id="selectOneBlackList" parameterType="string" resultType="black">
		select
			black_no as blackNo,
			black_start as blackStart,
			black_end as blackEnd,
			black_id as blackId,
			black_ty as blackTy
		from reading_black where black_id=#{readingId} and black_ty=0
	</select>
	<select id="selectOneNum" parameterType="reading" resultType="reading">
		select
			reading_no as readingNo,
			reading_time as readingTime,
			reading_day as readingDay,
			reading_num as readingNum,
			reading_id as readingId,
			reading_name as readingName,
			reading_ty as readingTy,
			reading_checkout as readingCheckOut
		from reading where reading_day=#{readingDay} and reading_num=#{readingNum}
	</select>
	<select id="selectOneId" parameterType="reading" resultType="reading">
		select
			reading_no as readingNo,
			reading_time as readingTime,
			reading_day as readingDay,
			reading_num as readingNum,
			reading_id as readingId,
			reading_name as readingName,
			reading_ty as readingTy,
			reading_checkout as readingCheckOut
		from reading where reading_day=#{readingDay} and reading_id=#{readingId}
	</select>
	<insert id="insertReading" parameterType="reading">
		insert into reading
			values(reading_seq.nextval,sysdate,#{readingDay},#{readingNum},#{readingId},(select member_name from member where member_id=#{readingId}),0,0)
	</insert>
	<delete id="reservationCancel" parameterType="reading">
		delete from reading where reading_day=#{readingDay} and reading_id=#{readingId}
	</delete>
	<select id="countSeat" parameterType="string" resultType="_int">
		select count(*) from reading where reading_day=#{readingDay}
	</select>
	<select id="chkSeat" parameterType="reading" resultType="_int">
		<![CDATA[
		select reading_num from reading where reading_day=#{readingDay} and reading_checkout = 0
		]]> 
	</select>
	<select id="selectWeekReading" resultType="reading">
		<![CDATA[
		select
			reading_no as readingNo,
			reading_time as readingTime,
			reading_day as readingDay,
			reading_num as readingNum,
			reading_id as readingId,
			reading_name as readingName,
			reading_ty as readingTy,
			reading_checkout as readingCheckOut
		from reading where reading_day >= TO_CHAR(SYSDATE-7,'YYYY-MM-DD')
		]]> 
	</select>
	<update id="expulsion" parameterType="reading">
		update reading set reading_checkout=2 where reading_day=#{readingDay} and reading_id=#{readingId}
	</update>
	<insert id="insertBlackList" parameterType="reading">
		<![CDATA[
		insert into reading_black 
			values(reading_black_seq.nextval,to_char(sysdate,'yy/mm/dd hh24:mi:ss'),to_date(to_char(sysdate+8,'yymmdd'))||' 00:00:00',#{readingId},0)
		]]> 
	</insert>
	<update id="earlyOut" parameterType="reading">
		update reading set reading_checkout=1 where reading_day=#{readingDay} and reading_id=#{readingId}
	</update>
	<select id="selectAllReading" resultType="reading">
		select
			reading_no as readingNo,
			reading_time as readingTime,
			reading_day as readingDay,
			reading_num as readingNum,
			reading_id as readingId,
			reading_name as readingName,
			reading_ty as readingTy,
			reading_checkout as readingCheckOut
		from reading
	</select>
</mapper>
		

